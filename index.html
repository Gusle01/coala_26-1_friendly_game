<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¹œí•´ì§€ê¸¸ ë°”ë¼ - Aì•ˆ ì ìˆ˜ ë ˆì´ìŠ¤</title>
  <style>
    :root {
      --bg: #f6f1e6;
      --panel: #fffaf0;
      --ink: #1c1b19;
      --accent: #c84c09;
      --accent-dark: #8e3506;
      --line: #d9c9ad;
      --ok: #0f6a4b;
      --warn: #8c5a00;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Pretendard", "Noto Sans KR", sans-serif;
      background:
        radial-gradient(circle at 5% 10%, #f7e2be 0%, transparent 30%),
        radial-gradient(circle at 95% 85%, #f5d2a4 0%, transparent 28%),
        var(--bg);
      color: var(--ink);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr;
    }

    .hero {
      background: linear-gradient(145deg, #fff7e2, #ffe6b5);
      border: 2px solid #f1ca7b;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
    }

    .hero h1 {
      margin: 0 0 8px;
      font-size: clamp(1.4rem, 3vw, 2rem);
    }

    .hero p {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(12, 1fr);
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 1.05rem;
    }

    .col-4 { grid-column: span 4; }
    .col-5 { grid-column: span 5; }
    .col-7 { grid-column: span 7; }
    .col-8 { grid-column: span 8; }
    .col-12 { grid-column: span 12; }

    label {
      display: block;
      font-size: 0.84rem;
      margin-bottom: 6px;
      font-weight: 600;
    }

    input, select, button {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #cdb998;
      padding: 10px;
      font-size: 0.92rem;
      background: #fff;
    }

    button {
      border: 0;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.12s ease, background 0.2s ease;
    }

    button:hover { background: var(--accent-dark); }
    button:active { transform: translateY(1px); }

    .row {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(2, 1fr);
      margin-bottom: 10px;
    }

    .row-3 {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(3, 1fr);
      margin-bottom: 10px;
    }

    .hint {
      font-size: 0.82rem;
      color: #564b3a;
      margin-top: 6px;
    }

    .pill {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-left: 6px;
      vertical-align: middle;
    }

    .pill.ok { background: #d8f3e8; color: var(--ok); }
    .pill.warn { background: #ffefcc; color: var(--warn); }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ebddc2;
      text-align: left;
    }

    th { font-size: 0.8rem; color: #5c4e35; }

    .rank {
      width: 38px;
      text-align: center;
      font-weight: 700;
    }

    .logs {
      max-height: 260px;
      overflow: auto;
      border: 1px solid #e8d9ba;
      border-radius: 10px;
      background: #fffdf8;
    }

    .log-item {
      padding: 10px;
      border-bottom: 1px solid #f0e4cc;
      font-size: 0.87rem;
      line-height: 1.4;
    }

    .log-item:last-child { border-bottom: 0; }

    .danger {
      background: #972d14;
      margin-top: 8px;
    }

    .race-board {
      display: grid;
      gap: 10px;
    }

    .track-row {
      display: grid;
      gap: 10px;
      grid-template-columns: 120px 1fr;
      align-items: center;
    }

    .team-tag {
      font-size: 0.86rem;
      font-weight: 700;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track {
      position: relative;
      border: 1px solid #ddc8a4;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffefce, #fde4b5);
      height: 34px;
      padding: 4px;
      overflow: hidden;
    }

    .runner {
      position: absolute;
      top: 4px;
      left: 4px;
      height: 24px;
      border-radius: 999px;
      background: linear-gradient(90deg, #e95d0f, #ff9f1a);
      color: #fff;
      font-size: 0.75rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 8px;
      transition: width 0.35s ease;
      min-width: 48px;
    }

    .flag {
      position: absolute;
      right: 10px;
      top: 7px;
      font-size: 0.95rem;
      opacity: 0.9;
    }

    @media (max-width: 900px) {
      .col-4, .col-5, .col-7, .col-8, .col-12 { grid-column: span 12; }
      .row, .row-3 { grid-template-columns: 1fr; }
      .track-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="container">
    <section class="hero">
      <h1>ì¹œí•´ì§€ê¸¸ ë°”ë¼ - Aì•ˆ ì ìˆ˜ ë ˆì´ìŠ¤</h1>
      <p>
        í™œë™ ì™„ë£Œ ì‹œ <b>ê¸°ë³¸ ì ìˆ˜ + ë‚œì´ë„ ì ìˆ˜</b>ë¥¼ ì–»ê³ , ì°¸ì—¬ ì¸ì›ì´ ë§ì„ìˆ˜ë¡ <b>íŒ€ì›Œí¬ ë³´ë„ˆìŠ¤</b>ë¥¼ ë°›ìŠµë‹ˆë‹¤.
        í™œë™ ì¹´í…Œê³ ë¦¬ ì„¸íŠ¸/ë¼ì¸ì„ ì±„ìš°ë©´ ì¶”ê°€ ë³´ë„ˆìŠ¤ê°€ ë“¤ì–´ê°€ë©°, ì´ì ìœ¼ë¡œ ìˆœìœ„ë¥¼ ê²½ìŸí•©ë‹ˆë‹¤.
      </p>
    </section>

    <section class="grid">
      <article class="card col-4">
        <h2>íŒ€ ë“±ë¡</h2>
        <div class="row">
          <div>
            <label for="memberName">íŒ€ëª…</label>
            <input id="memberName" placeholder="ì˜ˆ: 1ì¡° ë²ˆê°œíŒ€" />
          </div>
          <div style="display:flex; align-items:end;">
            <button id="addMemberBtn">íŒ€ ì¶”ê°€</button>
          </div>
        </div>
        <div class="hint">ì¤‘ë³µ íŒ€ëª…ì€ ë“±ë¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
      </article>

      <article class="card col-8">
        <h2>í™œë™ ê¸°ë¡í•˜ê¸°</h2>
        <div class="row-3">
          <div>
            <label for="actor">í™œë™ íŒ€</label>
            <select id="actor"></select>
          </div>
          <div>
            <label for="participantCount">ì°¸ì—¬ íŒ€ì› ìˆ˜</label>
            <input id="participantCount" type="number" min="1" value="2" />
          </div>
          <div>
            <label for="difficulty">ë‚œì´ë„</label>
            <select id="difficulty">
              <option value="easy">ì‰¬ì›€ (+10)</option>
              <option value="medium" selected>ë³´í†µ (+20)</option>
              <option value="hard">ì–´ë ¤ì›€ (+30)</option>
            </select>
          </div>
        </div>

        <div class="row-3">
          <div>
            <label for="category">ì¹´í…Œê³ ë¦¬</label>
            <select id="category">
              <option value="talk">ëŒ€í™” ë¯¸ì…˜</option>
              <option value="teamplay">í˜‘ë™ ë¯¸ì…˜</option>
              <option value="help">ë„ì›€ ë¯¸ì…˜</option>
              <option value="challenge">ë„ì „ ë¯¸ì…˜</option>
            </select>
          </div>
          <div>
            <label for="missionTitle">í™œë™ ì´ë¦„</label>
            <input id="missionTitle" placeholder="ì˜ˆ: ì„œë¡œ ì·¨í–¥ ì¸í„°ë·°" />
          </div>
          <div style="display:flex; align-items:end;">
            <button id="recordBtn">í™œë™ ì™„ë£Œ ë°˜ì˜</button>
          </div>
        </div>

        <div class="hint">
          ê¸°ë³¸ì ìˆ˜ 10ì  + ë‚œì´ë„ ì ìˆ˜(10/20/30ì ). ì°¸ì—¬ ì¸ì› 3ëª… ì´ìƒì´ë©´ 1ëª…ë‹¹ +20ì .
          ì¹´í…Œê³ ë¦¬ 4ê°œë¥¼ ìµœì†Œ 1íšŒì”© ì±„ìš°ë©´ ì„¸íŠ¸ ë³´ë„ˆìŠ¤ +40ì , í•œ ì¹´í…Œê³ ë¦¬ 3íšŒ ë‹¬ì„± ì‹œ ë¼ì¸ ë³´ë„ˆìŠ¤ +25ì .
        </div>
      </article>

      <article class="card col-12">
        <h2>ì¹œí•´ì§€ê¸¸ ë ˆì´ìŠ¤</h2>
        <div id="raceBoard" class="race-board"></div>
      </article>

      <article class="card col-7">
        <h2>ì‹¤ì‹œê°„ ë­í‚¹</h2>
        <table>
          <thead>
            <tr>
              <th class="rank">ìˆœìœ„</th>
              <th>íŒ€ëª…</th>
              <th>ì´ì </th>
              <th>í™œë™ìˆ˜</th>
              <th>ì„¸íŠ¸</th>
              <th>ë¼ì¸</th>
            </tr>
          </thead>
          <tbody id="rankingBody"></tbody>
        </table>
      </article>

      <article class="card col-5">
        <h2>ìµœê·¼ í™œë™ ë¡œê·¸</h2>
        <div id="logs" class="logs"></div>
        <button id="resetBtn" class="danger">ê²Œì„ ì´ˆê¸°í™”</button>
      </article>
    </section>
  </main>

  <script>
    const DIFFICULTY_POINTS = { easy: 10, medium: 20, hard: 30 };
    const BASE_POINTS = 10;
    const TEAM_MEMBER_BONUS_POINTS = 20;
    const TEAM_MEMBER_BONUS_START = 3;
    const SET_BONUS_POINTS = 40;
    const LINE_BONUS_POINTS = 25;
    const LINE_THRESHOLD = 3;
    const CATEGORIES = ["talk", "teamplay", "help", "challenge"];

    const state = {
      members: [],
      logs: []
    };

    function uid() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    }

    function createMember(name) {
      return {
        id: uid(),
        name,
        score: 0,
        missionCount: 0,
        categoryCount: {
          talk: 0,
          teamplay: 0,
          help: 0,
          challenge: 0
        },
        setBonusTaken: 0,
        lineBonusTaken: {
          talk: 0,
          teamplay: 0,
          help: 0,
          challenge: 0
        }
      };
    }

    function saveState() {
      localStorage.setItem("friendlyGameA", JSON.stringify(state));
    }

    function loadState() {
      const raw = localStorage.getItem("friendlyGameA");
      if (!raw) return;
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed.members) && Array.isArray(parsed.logs)) {
          state.members = parsed.members;
          state.logs = parsed.logs;
        }
      } catch (_) {
        localStorage.removeItem("friendlyGameA");
      }
    }

    function byId(id) {
      return state.members.find((m) => m.id === id);
    }

    function addLog(text) {
      state.logs.unshift({ id: uid(), text, at: new Date().toISOString() });
      state.logs = state.logs.slice(0, 80);
    }

    function computeBonus(member) {
      let bonus = 0;

      const allCategoriesDone = CATEGORIES.every((c) => member.categoryCount[c] > 0);
      if (allCategoriesDone && member.setBonusTaken === 0) {
        bonus += SET_BONUS_POINTS;
        member.setBonusTaken = 1;
      }

      CATEGORIES.forEach((c) => {
        const linesReady = Math.floor(member.categoryCount[c] / LINE_THRESHOLD);
        if (linesReady > member.lineBonusTaken[c]) {
          const newlyDone = linesReady - member.lineBonusTaken[c];
          bonus += newlyDone * LINE_BONUS_POINTS;
          member.lineBonusTaken[c] = linesReady;
        }
      });

      return bonus;
    }

    function recordMission() {
      const actorId = document.getElementById("actor").value;
      const participantCount = Number(document.getElementById("participantCount").value);
      const difficulty = document.getElementById("difficulty").value;
      const category = document.getElementById("category").value;
      const missionTitle = document.getElementById("missionTitle").value.trim();

      if (!actorId) {
        alert("í™œë™ íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }
      if (!Number.isInteger(participantCount) || participantCount < 1) {
        alert("ì°¸ì—¬ íŒ€ì› ìˆ˜ëŠ” 1ëª… ì´ìƒì˜ ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");
        return;
      }

      const actor = byId(actorId);
      if (!actor) return;

      const teamMemberBonusCount = Math.max(0, participantCount - (TEAM_MEMBER_BONUS_START - 1));
      const teamMemberBonus = teamMemberBonusCount * TEAM_MEMBER_BONUS_POINTS;
      const earned = BASE_POINTS + DIFFICULTY_POINTS[difficulty] + teamMemberBonus;

      actor.missionCount += 1;
      actor.categoryCount[category] += 1;
      actor.score += earned;

      const bonus = computeBonus(actor);
      if (bonus > 0) actor.score += bonus;

      const detail = missionTitle ? ` [${missionTitle}]` : "";
      const bonusText = bonus > 0 ? ` + ë³´ë„ˆìŠ¤ ${bonus}ì ` : "";
      const teamMemberText = teamMemberBonus > 0 ? ` + ì¸ì›ë³´ë„ˆìŠ¤ ${teamMemberBonus}ì ` : "";

      addLog(`${actor.name}${detail}: +${earned}ì  (ì°¸ì—¬ ${participantCount}ëª…)${teamMemberText}${bonusText}`);
      document.getElementById("missionTitle").value = "";

      saveState();
      renderAll();
    }

    function addMember() {
      const input = document.getElementById("memberName");
      const name = input.value.trim();
      if (!name) {
        alert("íŒ€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const duplicate = state.members.some((m) => m.name === name);
      if (duplicate) {
        alert("ì´ë¯¸ ê°™ì€ íŒ€ëª…ì´ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      state.members.push(createMember(name));
      input.value = "";

      saveState();
      renderAll();
    }

    function resetGame() {
      if (!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”? íŒ€/ì ìˆ˜/ë¡œê·¸ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.")) return;
      state.members = [];
      state.logs = [];
      saveState();
      renderAll();
    }

    function renderSelectOptions() {
      const actor = document.getElementById("actor");
      const options = ["<option value=''>ì„ íƒ</option>"]
        .concat(state.members.map((m) => `<option value="${m.id}">${m.name}</option>`))
        .join("");
      actor.innerHTML = options;
    }

    function sortedTeams() {
      return [...state.members].sort((a, b) => b.score - a.score || b.missionCount - a.missionCount);
    }

    function renderRace() {
      const raceBoard = document.getElementById("raceBoard");
      if (state.members.length === 0) {
        raceBoard.innerHTML = `<div class="hint">íŒ€ì„ ë“±ë¡í•˜ë©´ ë ˆì´ìŠ¤ê°€ ì‹œì‘ë©ë‹ˆë‹¤.</div>`;
        return;
      }

      const sorted = sortedTeams();
      const topScore = sorted[0].score;

      raceBoard.innerHTML = sorted.map((m, idx) => {
        const progress = topScore > 0 ? Math.max(8, Math.round((m.score / topScore) * 100)) : 8;
        return `
          <div class="track-row">
            <div class="team-tag">${idx + 1}ìœ„ ${m.name}</div>
            <div class="track">
              <div class="runner" style="width: ${progress}%;">${m.score}ì </div>
              <div class="flag">ğŸ</div>
            </div>
          </div>
        `;
      }).join("");
    }

    function renderRanking() {
      const tbody = document.getElementById("rankingBody");
      if (state.members.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6">íŒ€ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.</td></tr>`;
        return;
      }

      const sorted = sortedTeams();
      tbody.innerHTML = sorted.map((m, idx) => {
        const setDone = m.setBonusTaken > 0 ? "ì™„ë£Œ" : "-";
        const lineCount = Object.values(m.lineBonusTaken).reduce((x, y) => x + y, 0);
        const top = idx === 0 ? `<span class="pill ok">1ìœ„</span>` : "";
        const close = idx > 0 && sorted[0].score - m.score <= 30 ? `<span class="pill warn">ì¶”ê²©ê¶Œ</span>` : "";

        return `
          <tr>
            <td class="rank">${idx + 1}</td>
            <td>${m.name} ${top} ${close}</td>
            <td><b>${m.score}</b>ì </td>
            <td>${m.missionCount}</td>
            <td>${setDone}</td>
            <td>${lineCount}</td>
          </tr>
        `;
      }).join("");
    }

    function renderLogs() {
      const logs = document.getElementById("logs");
      if (state.logs.length === 0) {
        logs.innerHTML = `<div class="log-item">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }

      logs.innerHTML = state.logs.map((log) => {
        const time = new Date(log.at).toLocaleString("ko-KR", { hour12: false });
        return `<div class="log-item">${time}<br>${log.text}</div>`;
      }).join("");
    }

    function renderAll() {
      renderSelectOptions();
      renderRace();
      renderRanking();
      renderLogs();
    }

    document.getElementById("addMemberBtn").addEventListener("click", addMember);
    document.getElementById("recordBtn").addEventListener("click", recordMission);
    document.getElementById("resetBtn").addEventListener("click", resetGame);

    loadState();
    renderAll();
  </script>
</body>
</html>
